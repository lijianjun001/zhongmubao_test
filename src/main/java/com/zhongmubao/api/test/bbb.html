<html style="height: 100%; font-size: 54px;" data-dpr="1">
<head lang="en">
    <meta charset="UTF-8"/>
    <meta name="keywords" content=""/>
    <meta name="description" content=""/>
    <meta name="apple-mobile-web-app-capable" content="yes"/>
    <meta name="apple-touch-fullscreen" content="yes"/>
    <meta name="format-detection" content="telephone=no,email=no"/>
    <meta name="apple-mobile-web-app-status-bar-style" content="black"/>
    <link rel="shortcut icon" href="http://192.168.31.200:10210/weixin/images/favicon.ico"/>
    <link rel="stylesheet" type="text/css" href="http://192.168.31.200:10210/weixin/css/bind.min.css?v=2.2.20"/>
    <link rel="stylesheet" type="text/css" href="http://192.168.31.200:10210/weixin/css/malize.css?v=2.2.20"/>
    <link rel="stylesheet" type="text/css" href="http://192.168.31.200:10210/weixin/css/emubao.css?v=2.2.20"/>
    <link rel="stylesheet" type="text/css" href="http://192.168.31.200:10210/weixin/css/alertrem.css?v=2.2.20"/>
    <title>
        登录
    </title>
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"/>
</head>
<body style="height: 605px; font-size: 12px;">
<style>

    body, html {
        position: relative;
        width: 100%;
        height: 100%;
    }

</style>
<div class="login-div">
    <!--发送短信弹窗-->      <div class="login-send-cover">
    <div class="login-send-content">
        <div class="login-send-div">
            <div class="login-send-div-top">
                <div>
                    <p>
                        我们将发送短信验证码至:
                    </p>
                    <p>
                        13264242288
                    </p>
                </div>
            </div>
            <div class="login-send-div-bottom">
                <a class="send-cancel" href="javascript:void(0);">
                    取消
                </a>
                <a class="send-ok" href="javascript:void(0);">
                    确认
                </a>
            </div>
        </div>
    </div>
</div>
    <div class="login-div-title">
        <h1>
            登录众牧宝
        </h1>
        <p>
            立即打开 云端牧场
        </p>
    </div>
    <div class="login-div-input">
        <div class="login-div-div">
            <input type="tel" maxlength="11" id="txtAccount" placeholder="请输入手机号" value="13260213625"/>
            <img class="login-close" src="http://192.168.31.200:10210/weixin/images/login/login-close.png" alt=""/>
        </div>
    </div>
    <div class="login-div-input" id="passwordLogin">
        <div class="login-div-div">
            <input class="login-pwd-input" type="password" id="txtPassword" maxlength="16" placeholder="请输入登录密码" value="123456"/>
            <img class="login-pwd-img" src="http://192.168.31.200:10210/weixin/images/login/login-biyan.png" alt=""/>
        </div>
    </div>
    <div id="codeLogin" style="display:none">
        <div class="login-div-input">
            <div class="login-div-small">
                <input class="code-tu-input" type="text" maxlength="4" placeholder="请输入验证码"/>
                <img class="login-close" src="http://192.168.31.200:10210/weixin/images/login/login-close.png" alt=""/>
            </div>
            <img class="code-img" src="http://192.168.31.200:10210/weixin/images/codebg.png" alt=""/>
        </div>
        <div class="login-div-input">
            <div class="login-div-small">
                <input class="code-tel-input" type="tel" maxlength="6" placeholder="请输入手机验证码"/>
                <img class="login-close" src="http://192.168.31.200:10210/weixin/images/login/login-close.png" alt=""/>
            </div>
            <span id="btnGetCode" class="Couj-Code">
            获取验证码
          </span>
            <span class="Code-Time" href="javascript:void(0);" style="display: none;">
            <i>
              60
            </i>
            s
          </span>
        </div>
    </div>
    <a class="login-btn" href="javascript:void(0)">
        登录
    </a>
    <a class="login-btn redActive" href="javascript:void(0)" style="display: none">
    </a>
    <a class="login-btn greenActive" href="javascript:void(0)" style="display: none" id="btn_log">
        登录
    </a>
    <p class="login-div-qita">
        其它登录方式
    </p>
    <div class="login-div-bottom">
        <div class="login-div-bottom-top">
            <div>
                <a href="forgetPassword">
                    忘记密码
                </a>
                <i>
                </i>
                <a href="register">
                    快速注册
                </a>
            </div>
        </div>
        <p>
            登录即代表阅读并同意
            <a href="/Emubao/WebApp#/UserProtocol">
                《用户协议》
            </a>
        </p>
    </div>
</div>
<input type="hidden" id="txtImgGuid" value=""/>
<input type="hidden" id="txtTarget" value=""/>
<input type="hidden" id="txtSign" value=""/>
<!--弹出层 Start-->    <div class="commoncover alertA" alerta="" style="display: none;">
    <div class="commondiv">
        <img src="http://192.168.31.200:10210/weixin/images/commonbg.png" alt=""/>
        <img class="guoqing" src="http://192.168.31.200:10210/weixin/images/commonqi.png" alt="友情提示"/>
        <p class="text ng-binding" id="alert_txt">
        </p>
        <a href="javascript:void(0);" class="xiaci" style="display: none;">
            下次吧
        </a>
        <a href="javascript:void(0);" style="display: none;">
            去设置
        </a>
        <a href="javascript:void(0);" class="know yesBtn" onclick="$.emubao.close(); return false;" data-value="1">
            确定
        </a>
    </div>
</div>
<!--弹出层 End-->    <!--弹出跳转-->    <div class="commoncover alertB" alerta="" style="display: none;">
    <div class="commondiv">
        <img src="http://192.168.31.200:10210/weixin/images/commonbg.png" alt=""/>
        <img class="guoqing" src="http://192.168.31.200:10210/weixin/images/commonqi.png" alt="友情提示"/>
        <p class="text ng-binding" id="alertB_txt">
        </p>
        <a href="javascript:void(0);" class="xiaci" style="display: none;">
            下次吧
        </a>
        <a href="javascript:void(0);" style="display: none;">
            去设置
        </a>
        <a href="javascript:void(0);" id="Jumpbtn" class="know yesBtn">
            确定
        </a>
    </div>
</div>
<!--弹出跳转带取消-->    <div class="commoncover alertBWithCancel emubao-new-alert-withcancel" id="withcancel-alert" alerta="" style="display: none;">
    <div class="commondiv">
        <img src="http://192.168.31.200:10210/weixin/images/commonbg.png" alt="友情提示"/>
        <img class="guoqing" src="http://192.168.31.200:10210/weixin/images/commonqi.png" alt=""/>
        <p class="text ng-binding" id="alertB_txtWithCancel">
        </p>
        <a href="javascript:void(0);" class="yesBtn btnAlertCancel" style="display: block;">
            取消
        </a>
        <a href="javascript:void(0);" id="JumpbtnWithCancel" class="xiaci yesBtn" style="display: block;">
            确定
        </a>
        <a href="javascript:void(0);" class="know yesBtn" onclick="$.emubao.close(); return false;" data-value="1" style="display: none;">
            确定
        </a>
    </div>
</div>
<!--遮罩层 Start-->    <div class="loading" style="height: 605px;">
    <div class="sk-spinner sk-spinner-fading-circle">
        <div class="sk-circle1 sk-circle">
        </div>
        <div class="sk-circle2 sk-circle">
        </div>
        <div class="sk-circle3 sk-circle">
        </div>
        <div class="sk-circle4 sk-circle">
        </div>
        <div class="sk-circle5 sk-circle">
        </div>
        <div class="sk-circle6 sk-circle">
        </div>
        <div class="sk-circle7 sk-circle">
        </div>
        <div class="sk-circle8 sk-circle">
        </div>
        <div class="sk-circle9 sk-circle">
        </div>
        <div class="sk-circle10 sk-circle">
        </div>
        <div class="sk-circle11 sk-circle">
        </div>
        <div class="sk-circle12 sk-circle">
        </div>
    </div>
</div>
<!--遮罩层 End-->    <script type="text/javascript" src="http://192.168.31.200:10210/weixin/js/flexible.js?v=2.2.20">
</script>
<script src="http://192.168.31.200:10210/weixin/js/jweixin.js?v=2.2.20">
</script>
<script src="http://192.168.31.200:10210/weixin/js/jquery-1.9.1.min.js?v=2.2.20">
</script>
<script src="http://192.168.31.200:10210/weixin/js/jquery.tmpl.min.js?v=2.2.20">
</script>
<script src="http://192.168.31.200:10210/weixin/js/emubao.view.js?v=2.2.20">
</script>
<script type="text/javascript">
    //<![CDATA[


    var setings = {
        ShareSuccess: 'http://192.168.31.200:46018/Customer/ShareSuccess',
        PayError: 'http://192.168.31.200:46018/Emubao/WebApp#/PayError',
        PayInteractive: 'http://192.168.31.200:46018/Emubao/PayInteractive',
        AppID: 'wx1ac9a18957d9b68e',
        ResourceAddress: 'http://192.168.31.200:10210/weixin/',
        UnionPay: 'http://192.168.31.200:46018/Emubao/UnionPay',
        Platform: '03',
        ShareBuySheep: 'http://192.168.31.200:46018/Emubao/WebApp#/SharePage',
        ShareLibraryProduct: 'http://192.168.31.200:46018/Emubao/WebApp#/LibraryShare',
        PaySuccess: 'http://192.168.31.200:46018/Emubao/WebApp#/PaySuccess',
        ShareTime: '',
        ShareSignature: '',
        CurrentUserSign: ''
    };
    var resourceUrl = 'http://192.168.31.200:10210/weixin/';
    var a = 'http://192.168.31.200:46018/Account/Login';

    //]]>
</script>
<script type="text/javascript">
    //<![CDATA[

    var fastFlag = true;
    var isValidate = false;
    $(function () {
        GetImgCode();
        $('body').height($('body')[0].clientHeight); //这句话解决安卓机键盘顶起div
        $('.send-cancel').click(function () {
            $('.login-send-cover').hide();
        });
        $('.send-ok').click(function () {
            //            $('.login-send-cover').hide();
        });

        $("#txtAccount,.code-tel-input,.code-tu-input,#txtPassword").bind("input propertychange",
            function () {
                if (!fastFlag) {
                    check();
                } else {
                    var val = $("#txtAccount").val();
                    if (val.length == 11) {
                        $.emubao.ajaxAsync('/Account/IsSetPassword', { account: val, r: Math.random() }, function (rsp) {
                            if (rsp.Result == 0) {
                                if (rsp.Message == '0') {
                                    $.emubao.alertCallbackWithCancel('<div>陛下，您还没有注册众牧宝，请先注册！</div>', '马上注册', function () {
                                        location.href = '/Account/Register?account=' + val;
                                    }, function () { });
                                }
                                else if (rsp.Message == '1') {
                                    $.emubao.alertTarget('<div style="margin-bottom: 10px;">陛下，由于众牧宝系统升级</div><div>请设置登录密码后重新登录！</div>', '/Account/ForgetPassword?' + window.btoa("phone") + encode(val), '去设置');
                                }
                            }
                        }, 'unloading');
                    }


                    if (false === $.emubao.validator.isPhone($("#txtAccount").val())) {
                        if ($("#txtAccount").val() == "") {
                            $('.login-btn').show();
                            $('.redActive').hide();
                            $('#btn_log').hide();
                        } else {
                            $('.login-btn').hide();
                            $('.redActive').show().html("请输入正确的手机号");
                            $('#btn_log').hide();
                        }
                    } else {
                        if ($('#txtPassword').val() !== "" && $('#txtPassword').val().length >= 6 && $('#txtPassword').val().length <= 16) {
                            $('.login-btn').hide();
                            $('.redActive').hide();
                            $('#btn_log').show();
                        } else {
                            $('.login-btn').show();
                            $('.redActive').hide();
                            $('#btn_log').hide();
                        }
                    }
                }
            });
        var flag = true;
        $('.login-pwd-img').click(function() {
            if (flag == false) {
                $(this).attr('src', 'http://192.168.31.200:10210/weixin/images/login/login-biyan.png');
                $('.login-pwd-input').attr('type', 'password');
                flag = true;
            } else {
                $(this).attr('src', 'http://192.168.31.200:10210/weixin/images/login/login-zhengyan.png');
                $('.login-pwd-input').attr('type', 'text');
                flag = false;
            }
        });


        $(".login-div-input").bind("input propertychange", function () {
            if ($(this).find('input').val() == '') {
                $(this).find('.login-close').css('display', 'none');
            } else {
                $(this).find('.login-close').css('display', 'block');
            }
        });
        $('.login-close').click(function () {
            $(this).parent().children('input').val('');
            $(this).css('display', 'none');
            check();
        });



        //获取验证码
        $("#btnGetCode").click(function () {
            var account = $('#txtAccount').val();
            var returnUrl = $('#txtTarget').val();
            var sign = $('#txtSign').val();
            var recommand = $('#txtRecommand').val();
            if (false == $.emubao.validator.isPhone(account)) {
                $('.login-btn').hide();
                $('.redActive').show().html("请输入正确的手机号");
                $('#btn_log').hide();
                return false;
            }

            var imgcode = $('.code-tu-input').val();
            if (imgcode == "") {
                $('.login-btn').hide();
                $('.redActive').show().html("图片验证码错误，请重新输入");
                $('#btn_log').hide();
                return false;
            }
            var imgguid = $('#txtImgGuid').val();
            if (imgguid == "") {
                $('.login-btn').hide();
                $('.redActive').show().html("图片验证码错误，请重新输入");
                $('#btn_log').hide();
                return false;
            }
            try {
                clearTimeout(Bs.Timeoutname); //关闭定时器
            } catch (e) {

            }
            $.emubao.ajaxAsync('/Account/SendSmsAndImg',
                { phone: account, imgguid: imgguid, imgcode: imgcode},
                function(rsp) {
                    if (rsp.Result == 0) {
                        //$.emubao.alert('验证码发送成功，注意查收!');
                        $('.login-btn').show();
                        $('.redActive').hide();
                        $('#btn_log').hide();
                        $('.Couj-Code').hide();
                        $('.Code-Time').show();

                        CodePuhTimer();
                    } else {
                        $('.login-btn').hide();
                        $('.redActive').show().html(rsp.Message);
                        $('#btn_log').hide();
                    }
                });
        });


        $(".login-div-qita").click(function() {

            if (fastFlag) {
                fastFlag = false;
                $("#passwordLogin").hide();
                $("#codeLogin").show();
                $('.login-btn').show();
                $('.redActive').hide();
                $('#btn_log').hide();
            } else {
                fastFlag = true;
                $("#passwordLogin").show();
                $("#codeLogin").hide();
            }


        });
        //登录
        $("#btn_log").click(function() {
            var account = $('#txtAccount').val();
            var returnUrl = $('#txtTarget').val();
            var code = $(".code-tel-input").val();
            if (false === $.emubao.validator.isPhone(account)) {
                $('.login-btn').hide();
                $('.redActive').show().html("请正确填写 手机号");
                $('#btn_log').hide();
                return false;
            }

            if (!fastFlag) {
                if (code === '') {
                    $('.login-btn').hide();
                    $('.redActive').show().html("请输入验证码");
                    $('#btn_log').hide();
                    return false;
                }
                $.emubao.ajaxAsync('/Account/LoginByPhoneCode',
                    { account: account, code: code, r: Math.random() },
                    function(rsp) {
                        if (rsp.Result === 0) {
                            $('#txtUmeng').val(rsp.Sign);
                            setings.CurrentUserSign = rsp.Sign;
                            if (returnUrl !== '' && returnUrl !== 'undefined') {
                                location.href = returnUrl;
                            } else {
                                location.href = '/';
                            }
                        } else {
                            $('.login-btn').hide();
                            $('.redActive').show().html(rsp.Message);
                            $('#btn_log').hide();
                        }
                    });

            } else {

                var password = $('#txtPassword').val();
                if (password === '') {
                    $('.login-btn').hide();
                    $('.redActive').show().html('请输入密码');
                    $('#btn_log').hide();
                    return false;
                }

                if (isValidate) {
                    if (code === '') {
                        $.emubao.alert('请输入验证码');
                        return false;
                    }
                }
                $.emubao.ajaxAsync('/Account/Login',
                    { account: account, password: password, code: code, r: Math.random() },
                    function(rsp) {
                        if (rsp.Result === 0) {
                            $('#txtUmeng').val(rsp.Sign);
                            setings.CurrentUserSign = rsp.Sign;
                            if (returnUrl !== '' && returnUrl !== 'undefined') {
                                location.href = returnUrl;
                            } else {
                                location.href = '/';
                            }
                        } else {
                            $('.login-btn').hide();
                            $('.redActive').show().html('账户密码错误');
                            $('#btn_log').hide();
                        }
                    });
            }

        });

    });

    function check() {
        var account = $('#txtAccount').val();
        var pickerCode = $('.code-tu-input').val();
        var code = $(".code-tel-input").val();
        if (false === $.emubao.validator.isPhone(account)) {
            $('.login-btn').show();
            $('.redActive').hide();
            $('#btn_log').hide();
            //$('.redActive').show().html("请正确填写手机号");
            return false;
        }
        if (pickerCode === '') {
            $('.login-btn').show();
            $('.redActive').hide();
            $('#btn_log').hide();
            //$('.redActive').show().html("请输入图片验证码");
            return false;
        }
        if (code === '') {
            $('.login-btn').show();
            $('.redActive').hide();
            $('#btn_log').hide();
            //$('.redActive').show().html("请输入手机验证码");
            return false;
        }

        $('.login-btn').hide();
        $('.redActive').hide();
        $('#btn_log').show();

    }
    function GetImgCode() {
        $.emubao.ajaxAsync('/Account/SendSmsImg',
            {},
            function(rsp) {
                if (rsp.Result == 0) {
                    console.log(rsp);
                    $('#txtImgGuid').val(rsp.Data.ImgGuid);
                    $('.code-img').attr("src", rsp.Data.ImgUrl);
                    $('.code-img').click(function() {
                        GetImgCode();
                        $('.code-img').unbind("click");
                    });

                } else {
                    $.emubao.alert(rsp.Message);
                }
            });
    }

    function filterHTMLTag(msg) {
        msg = msg.replace(/<\/?[^>]*>/g, ""); // HTML标记
        msg = msg.replace(/([\r\n])[\s]+/g, ""); // 换行、空格
        msg = msg.replace(/<!--.*-->/g, ""); // HTML注释
        msg = msg.replace(/javascript/ig, ""); // javascript
        msg = msg.replace(/script/ig, ""); // script标签
        msg = msg.replace(/alert(\/?[^>]*)/ig, ""); // alert() 内容
        return msg;
    }
    // 加密
    function encode(str) {
        var r = "";
        // string 类型的可以当做字符串对象来用
        for (var i = 0; i < str.length; i++) {
            // 取出下标为 i 字符的编码
            var code = str.charCodeAt(i);
            // 将字符对应的编码，拼接到一个空字符串上
            r += code;
            // 每个符号后，添加 , 分割
            r += ",";
        }
        // secret.value
        // 设置输入框的内容为 r
        return r;
    }

    //]]>
</script>
</body>
</html>